{% load widget_tweaks %}
{% block content %}
    <form method="POST" class="load-form">
        <div class="modal-header">
            <h3 class="modal-title">Create Load</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <div class="modal-body">
            <div class="form-group">
                {% csrf_token %}
                <label for="{{ form.pickup_date.id_for_label }}">{{ form.pickup_date.label }}</label>
                {% render_field form.pickup_date class="form-control" placeholder="mm/dd/aaaa" %}
                <label for="{{ form.ref.id_for_label }}#">{{ form.ref.label }}</label>
                {% render_field form.ref class="form-control" placeholder="ref#" %}
                <label for="{{ form.origin_city.id_for_label }}">{{ form.origin_city.label }}</label>
                {% render_field form.origin_city class="form-control" placeholder="Type a city" %}
                <label for="{{ form.destination_city.id_for_label }}">{{ form.destination_city.label }}</label>
                {% render_field form.destination_city class="form-control" placeholder="Type a city" %}
                <label for="{{ form.shipper_price.id_for_label }}">Price</label>
                {% render_field form.shipper_price class="form-control" placeholder="Sugested price" onfocus="calc_price()" %}
                {% if form.errors %}
                    {{ form.non_field_errors }}
                {% endif %}
            </div>
        </div>
        <div class="modal-footer">
            <button type="submit" class="save btn btn-secondary">Save</button>
        </div>
    </form>
    {% block extrascripts %}
        <script>
            origin = document.getElementById('id_origin_city');
            destination = document.getElementById('id_destination_city');
            autocomplete_origin = new google.maps.places.Autocomplete(origin);
            autocomplete_destination = new google.maps.places.Autocomplete(destination);

            var price = document.getElementById('id_shipper_price');
            var directionsService = new google.maps.DirectionsService();

            function calc_price() {
                var request = {
                    origin: origin.value,
                    destination: destination.value,
                    travelMode: google.maps.TravelMode.DRIVING,
                    unitSystem: google.maps.UnitSystem.IMPERIAL,
                }

                directionsService.route(request, function (result, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        distance = result.routes[0].legs[0].distance.text.slice(0, -3).replace(".", "").replace(",", ".");
                        price.value = ((distance * 150.0) / 100.0).toFixed(2);
                    }
                });
            }
        </script>
    {% endblock extrascripts %}
{% endblock %}
